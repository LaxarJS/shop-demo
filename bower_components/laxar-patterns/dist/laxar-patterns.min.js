/** Copyright 2015 aixigo AG, Released under the MIT license: http://laxarjs.org/license */
define("laxar-patterns/lib/actions",["angular","laxar"],function(a,b){"use strict";function c(a,c,e){var f=b.object.path(a.features,c+".action",null);return d(a,f,e)}function d(a,c,d){b.assert(a).hasType(Object).hasProperty("eventBus"),b.assert(c).hasType(String).isNotNull();var e=b.object.options(d,{deliverToSender:!1,onSuccess:i,onError:i,onComplete:i});b.assert(e.onSuccess).hasType(Function).isNotNull(),b.assert(e.onError).hasType(Function).isNotNull(),b.assert(e.onComplete).hasType(Function).isNotNull();var f={deliverToSender:e.deliverToSender};return e.timeout>0&&(f.pendingDidTimeout=e.timeout),function(d){var g=b.object.options(d,{action:c});return a.eventBus.publishAndGatherReplies("takeActionRequest."+c,g,f).then(function(a){var b=a.some(function(a){return a.event.outcome===l});if(e.onComplete(a.slice(0)),b)throw e.onError(a.slice(0)),a;return e.onSuccess(a.slice(0)),a})}}function e(a){return b.assert(a).hasType(Object).hasProperty("eventBus"),new f(a)}function f(a){this.scope_=a}function g(c,d,e,f,g){c.publish("willTakeAction."+d,{action:d},j);var i,m={action:d,outcome:k};try{i=e(f,g)}catch(n){throw m.outcome=l,c.publish("didTakeAction."+d+"."+l,m,j),n}h.when(i).then(function(b){return a.isObject(b)&&(m.outcome=b.outcome===l?l:k),b},function(b){return m.outcome=l,a.isObject(b)&&(m.outcome=b.outcome===k?k:l),b}).then(function(a){m=b.object.options(m,a);var e="didTakeAction."+d+"."+m.outcome;c.publish(e,m,j)})}var h;a.injector(["ng"]).invoke(["$q",function(a){h=a}]);var i=function(){},j={deliverToSender:!1},k="SUCCESS",l="ERROR";return f.prototype.registerActionsFromFeature=function(a,c){var d=b.object.path(this.scope_.features,a+".onActions")||[];return this.registerActions(d,c)},f.prototype.registerActions=function(a,c){b.assert(a).hasType(Array).isNotNull(),b.assert(c).hasType(Function).isNotNull();var d=this;return a.forEach(function(a){d.scope_.eventBus.subscribe("takeActionRequest."+a,function(b,e){g(d.scope_.eventBus,a,c,b,e)})}),this},{publisher:d,publisherForFeature:c,handlerFor:e,OUTCOME_ERROR:l,OUTCOME_SUCCESS:k}}),define("laxar-patterns/lib/errors",["laxar"],function(a){"use strict";function b(b,d,e){c(b).hasType(Object).isNotNull(),c(b.eventBus).hasType(Object).isNotNull(),c(e).hasType(Object);var f=e&&e.localizer;c(f).hasType(Function);var g=a.object.path(b.features,d);return c(g).hasType(Object).isNotNull(),function(d,e,h,i){var j=a.object.path(g,e);c(j).isNotNull(),h=h||{},b.eventBus.publish("didEncounterError."+d,{code:d,message:a.string.format(f?f(j):j,[],h),data:h,cause:i||{}},{deliverToSender:!1})}}var c=a.assert;return{errorPublisherForFeature:b}}),define("laxar-patterns/lib/flags",["laxar"],function(a){"use strict";function b(a){return new c(a)}function c(a){this.scope_=a}function d(a){if(!a)return[];var b=Array.isArray(a)?a:[a];return b.map(function(a){var b=0===a.indexOf("!");return{name:b?a.substr(1):a,negated:b,state:b}})}function e(a){if(!a)return function(){};var b=Array.isArray(a)?a:[a];return function(a,c){b.forEach(function(b){b(a,c)})}}function f(a,b){var c=a.reduce(g[b],null);return null===c?!1:c}c.prototype.registerFlagFromFeature=function(b,c){return this.registerFlag(a.object.path(this.scope_.features,b,[]),c)},c.prototype.registerFlag=function(b,c){c=a.object.options(c,{predicate:"any"});var g=function(){};"scopeKey"in c&&(g=function(b){a.object.setPath(this.scope_,c.scopeKey,b)}.bind(this));var h=d(b),i=e(c.onChange),j="boolean"==typeof c.initialState?c.initialState:f(h,c.predicate);return g(j),h.forEach(function(a){this.scope_.eventBus.subscribe("didChangeFlag."+a.name,function(b){a.state=a.negated?!b.state:b.state;var d=f(h,c.predicate);d!==j&&(g(d),i(d,j),j=d)}.bind(this))}.bind(this)),this};var g={any:function(a,b){return null===a?b.state:b.state||a},all:function(a,b){return null===a?b.state:b.state&&a}};return{handlerFor:b}}),define("laxar-patterns/lib/i18n",["laxar"],function(a){"use strict";function b(b,c){function d(c){var d=c.locale,e=a.object.path(b,f).tags,h=e[d];h!==c.languageTag&&(e[d]=c.languageTag,g[d].forEach(function(a){a(c,h)}))}function e(){var c=a.object.path(b,f);c||(c={},a.object.setPath(b,f,c)),c.tags||(c.tags={})}var f=c||"i18n";e();var g={},h={registerLocale:function(a,c){var e=a;return Array.isArray(a)||(e=a?[a]:[]),e.forEach(function(a){g[a]||(g[a]=[],b.eventBus.subscribe("didChangeLocale."+a,d));var e=(c||{}).onChange;e&&(g[a]=g[a].concat(Array.isArray(e)?e:[e]))}),h},registerLocaleFromFeature:function(c,d){var e=a.object.path(b.features,c);return h.registerLocale(e.locale||e,d||{})},scopeLocaleFromFeature:function(c,d){var e=a.object.path(b.features,c);return b.i18n.locale=e.locale||e,h.registerLocale(b.i18n.locale,d||{})},localizer:function(c){function d(b){if("string"==typeof b)return b;var d=e.tags[e.locale];return d?a.i18n.localizer(d,c)(b):c}var e=a.object.path(b,f);return d.format=function(b,c){var d=a.i18n.localizer(e.tags[e.locale]);return d.format.apply(d,arguments)},d}};return h}return{handlerFor:b}}),define("laxar-patterns/lib/json",["laxar","json-patch"],function(a,b,c){"use strict";function d(a,b,d){for(var e=b.split("/"),f=e.length,g=-1!==b.indexOf("~"),h=1;f>h;++h){if(a===c)return d;if(Array.isArray(a)){var i=parseInt(e[h],10);a=a[i]}else{var j=e[h];g&&(j=j.replace(/~1/g,"/").replace(/~0/g,"~")),a=a[j]}}return a===c?d:a}function e(b,c,d){var e=f(c);return a.object.setPath(b,e,d)}function f(a){var b=a.split("/").slice(1);if(-1!==a.indexOf("~"))for(var c=b.length,d=0;c>d;++d)b[d]=b[d].replace(/~1/g,"/").replace(/~0/g,"~");return b.join(".")}function g(a){if(""===a)return"";var b=a.split(".");if(-1!==a.indexOf("/")||-1!==a.indexOf("~"))for(var c=b.length,d=0;c>d;++d)b[d]=b[d].replace(/~/g,"~0").replace(/\//g,"~1");return"/"+b.join("/")}function h(a,c){b.apply(a,c)}function i(a,c){return b.compare(a,c)}return{getPointer:d,setPointer:e,pointerToPath:f,pathToPointer:g,applyPatch:h,createPatch:i}}),define("laxar-patterns/lib/patches",["laxar"],function(a){"use strict";function b(b,c){if(Array.isArray(c)){var d=c;c={},d.forEach(function(a,b){"undefined"!=typeof a&&(c[b]=a)})}Object.keys(c).sort(function(a,b){return a.length-b.length}).forEach(function(d){a.object.setPath(b,d,c[d])})}function c(a,b){function c(a,b,d){var e;for(e in a)if(a.hasOwnProperty(e)&&("$"!==e.charAt(0)||"$"!==e.charAt(1))){var h=a[e],j=d.concat(e);null==b[e]?i[j.join(".")]=f(g(h)):h&&"object"==typeof h?c(h,b[e],j):h!==b[e]&&(i[j.join(".")]=h)}for(e in b)b.hasOwnProperty(e)&&(e in a||(i[d.concat(e).join(".")]=null))}var d=e(a),h=e(b);if("array"!==d&&"object"!==d)return null;if(d!==h)return g(a);var i={};return c(a,b,[]),i}function d(a,c){var d={},e=Object.keys(a),f=Object.keys(c);return e.forEach(function(b){for(var c=0;c<f.length;++c)if(b===f[c]||0===b.indexOf(f[c]+"."))return;d[b]=a[b]}),f.forEach(function(f){for(var g=0;g<e.length;++g){var h=e[g],i=h+".";if(0===f.indexOf(i)){var j={};j[f.replace(i,"")]=c[f];var k=a[h];return b(k,j),void(d[h]=k)}}d[f]=c[f]}),d}function e(a){if(null===a)return"null";if("undefined"==typeof a)return"undefined";var b=Object.prototype.toString.call(a).split(" ")[1];return b?b.substr(0,b.length-1).toLowerCase():void 0}function f(a){if(null===a)return a;for(var b in a)a.hasOwnProperty(b)&&("$"===b.charAt(0)&&"$"===b.charAt(1)?delete a[b]:"object"==typeof a[b]&&f(a[b]));return a}var g=a.object.deepClone;return{apply:b,create:c,merge:d}}),define("laxar-patterns/lib/resources",["angular","laxar","json-patch","./patches"],function(a,b,c,d){"use strict";function e(a,b){r(a).hasType(Object).isNotNull(),r(b).hasType(String).isNotNull();var c=o(a);return function(a){return null==c[b]&&null==a.data?!1:(c[b]=a.data,!0)}}function f(a,b){r(a).hasType(Object).isNotNull(),r(b).hasType(String).isNotNull();var d=o(a);return function(a){return null!=d[b]&&Array.isArray(a.patches)?(c.apply(d[b],a.patches),!0):!1}}function g(a,c,d){r(a).hasType(Object).isNotNull(),r(a.eventBus).hasType(Object).isNotNull();var e=b.object.path(a.features,c+".resource");r(e).hasType(String).isNotNull();var f=b.object.options(d,{deliverToSender:!1});return function(b){return a.eventBus.publish("didReplace."+e,{resource:e,data:b},{deliverToSender:!!f.deliverToSender})}}function h(d,e,f){r(d).hasType(Object).isNotNull(),r(d.eventBus).hasType(Object).isNotNull();var g=b.object.path(d.features,e+".resource");r(g).hasType(String).isNotNull();var h=b.object.options(f,{deliverToSender:!1}),i=function(c){return r(c).hasType(Array).isNotNull(),c&&c.length?d.eventBus.publish("didUpdate."+g,{resource:g,patches:c},{deliverToSender:!!h.deliverToSender}):(b.log.trace('updatePublisher: Not sending empty didUpdate to resource "[0]" from sender "[1]".',g,(d.widget||{id:"unknown"}).id),q=q||a.injector(["ng"]).get("$q"),q.when())};return i.compareAndPublish=function(a,b){var d=c.compare(a,b);return i(d)},i}function i(a){return new j(a)}function j(a){this.context_=a,this.externalHandlers_={},this.modelHandlers_={},this.waitingFor_=[],this.allReplacedCallback_=function(){}}function k(a,b,c){function d(b){var c=!0;return function(){return c?void(c=!1):b.apply(a,arguments)}}a.externalHandlers_[b]||(a.externalHandlers_[b]={onReplace:[],onUpdate:[]}),n(a.externalHandlers_[b].onUpdate,c.onUpdate),n(a.externalHandlers_[b].onUpdate,c.onUpdateReplace);var e=[];n(e,c.onReplace),n(e,c.onUpdateReplace),c.omitFirstReplace&&(e=e.map(function(a){return d(a)})),n(a.externalHandlers_[b].onReplace,e)}function l(a,b,c){var d=e(a.context_,c.modelKey);return a.modelHandlers_[b].onReplace?void a.modelHandlers_[b].onReplace.push(d):(a.modelHandlers_[b].onReplace=[d],void a.context_.eventBus.subscribe("didReplace."+b,function(c){var d=a.modelHandlers_[b].onReplace.reduce(function(a,b){return b(c)||a},!1);if(d)try{a.externalHandlers_[b].onReplace.forEach(function(a){a(c)})}finally{a.waitingFor_.splice(a.waitingFor_.indexOf(b),1),a.waitingFor_.length||a.allReplacedCallback_()}}))}function m(a,b,c){var d=f(a.context_,c.modelKey);return a.modelHandlers_[b].onUpdate?void a.modelHandlers_[b].onUpdate.push(d):(a.modelHandlers_[b].onUpdate=[d],void a.context_.eventBus.subscribe("didUpdate."+b,function(c){var d=a.modelHandlers_[b].onUpdate.reduce(function(a,b){return b(c)||a},!1);if(d)try{a.externalHandlers_[b].onUpdate.forEach(function(a){a(c)})}finally{a.waitingFor_.length||a.allReplacedCallback_()}}))}function n(a,b){return"function"==typeof b?void a.push(b):void(Array.isArray(b)&&Array.prototype.push.apply(a,b))}function o(a){return a.hasOwnProperty("resources")&&"object"==typeof a.resources||(a.resources={}),a.resources}function p(a,c,d){if(null==a||null==c)return!1;for(var e=0,f=0;f<d.length;++f){var g=d[f];if(-1!==g.indexOf(".")){var h=b.object.path(a,g),i=b.object.path(c,g);if(void 0===h&&void 0===i)continue;if(h!==i)return!1;++e}else{if(!(g in a||g in c))continue;if(a[g]!==c[g])return!1;++e}}return e>0}var q,r=b.assert;return j.prototype.registerResourceFromFeature=function(a,c){var d=b.object.path(this.context_.features,a+".resource",null);return c=b.object.options(c,{isOptional:!1}),null===d&&c.isOptional?this:(r(d).isNotNull('Could not find resource configuration in features for "'+a+'"'),c.modelKey||(c.modelKey=a.substr(a.lastIndexOf(".")+1)),this.registerResource(d,c))},j.prototype.registerResource=function(a,c){return r(a).hasType(String).isNotNull(),c=b.object.options(c,{omitFirstReplace:!1,modelKey:a}),this.waitingFor_.push(a),k(this,a,c),a in this.modelHandlers_||(this.modelHandlers_[a]={}),l(this,a,c),m(this,a,c),this},j.prototype.whenAllWereReplaced=function(a,b){function c(){a(),a=function(){}}return r(a).hasType(Function).isNotNull(),this.allReplacedCallback_=b&&b.watch?a:c,this},j.prototype.wereAllReplaced=function(){return!this.waitingFor_.length},{replaceHandler:e,updateHandler:f,replacePublisherForFeature:g,updatePublisherForFeature:h,isSame:p,handlerFor:i}}),define("laxar-patterns/lib/validation",[],function(){"use strict";function a(a,b,c){var d=[];return b&&b.length&&(d=b.map(function(a){return a.htmlMessage&&a.level?a:{htmlMessage:a,level:"ERROR"}})),{resource:a,data:d,outcome:c}}function b(a,b){return Array.isArray(a)?a:[].slice.call(b,1)}return{successEvent:function(c,d){return a(c,b(d,arguments),"SUCCESS")},errorEvent:function(c,d){return a(c,b(d,arguments),"ERROR")}}}),define("laxar-patterns/lib/visibility",["laxar"],function(a){"use strict";function b(a,b){return new c(a,b)}function c(b,c){this.scope_=b,b.isVisible=!1;var e=a.object.options(c,{});if(e.onAnyAreaRequest){var f=["changeAreaVisibilityRequest",b.widget.id].join(".");b.eventBus.subscribe(f,d(this,e.onAnyAreaRequest))}var g=["didChangeAreaVisibility",b.widget.area].join(".");b.eventBus.subscribe(g,function(a){var c=b.isVisible||!1;b.isVisible=a.visible,c!==a.visible&&(e.onChange&&e.onChange(a),e.onShow&&a.visible?e.onShow(a):e.onHide&&!a.visible&&e.onHide(a))})}function d(a,b){return function(c){var d=b(c);if(d===!0||d===!1){var e=["didChangeAreaVisibility",c.area,d].join(".");a.scope_.eventBus.publish(e,{area:c.area,visible:d},{deliverToSender:!1})}}}function e(a){return function(b){var c=["changeWidgetVisibilityRequest",a.widget.id,b].join(".");return a.eventBus.publishAndGatherReplies(c,{widget:a.widget.id,visible:b},{deliverToSender:!1})}}function f(a,b){return function(c){var d=["changeAreaVisibilityRequest",b,c].join(".");return a.eventBus.publishAndGatherReplies(d,{area:b,visible:c},{deliverToSender:!1})}}return c.prototype.registerArea=function(b,c){var e=a.object.options(c,{});if(e.onRequest){var f=["changeAreaVisibilityRequest",b].join(".");this.scope_.eventBus.subscribe(f,d(this,e.onRequest))}return this},{handlerFor:b,requestPublisherForWidget:e,requestPublisherForArea:f}}),define("laxar-patterns/laxar-patterns",["./lib/actions","./lib/errors","./lib/flags","./lib/i18n","./lib/json","./lib/patches","./lib/resources","./lib/validation","./lib/visibility"],function(a,b,c,d,e,f,g,h,i){"use strict";return{actions:a,errors:b,flags:c,i18n:d,json:e,patches:f,resources:g,validation:h,visibility:i}}),define("laxar-patterns",["laxar-patterns/laxar-patterns"],function(a){return a});
//# sourceMappingURL=laxar-patterns.min.js.map